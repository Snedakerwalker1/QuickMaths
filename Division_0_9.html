<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>QuickMaths | Division 0-9</title>

<!---<link rel="stylesheet" href="css/style.css">-->
<link rel = "stylesheet"
   type = "text/css"
   href = "src/CSS/Home_Page_Style.css" />
</head>

<body>

<STYLE>A {text-decoration: none;} </STYLE>
<button class="tablink" id="HomeTab" onclick="returnInterupt()">QuickMaths Home</button>

<button class="tablink" onclick="testOpenPage('test1')" id="defaultOpen">Test</button>

<div id="test1" class="tabcontent">
  <div class="wrapper">
    <h3>Division 0-9 Test</h3>
  </div>
  <p>To begin the test first input how much time, in minutes, you want to give yourself for the test, or click the no time limit button. 
    The standard amount of time in person would be 3 minutes, but feel free to pick any time! </p>
  <div class="wrapper">
    <form name="testTimeForm" id="testTimeForm" onsubmit="event.preventDefault(); submit_time('testdiv', 'testTimeForm', 'time1', true);">
      Time Limit: <input type="number" min="1" max="30" step="1" name="time1" value="3"><br><br> 
    </form> 
    <button class="button2 button12" onclick="submit_time('testdiv', 'testTimeForm','time1', false)"> No Time Limit </button>
    <button class="button2 button12" onclick="submit_time('testdiv','testTimeForm', 'time1', true)"> Begin Test</button>
  </div>
</div>
<!-- Once the time is filled out in the start page, the test page here will be activated. -->
<div id="testdiv" class="tabcontent">
  <h3>Division 0-9 Test</h3>
  <p> Enter your answer in the space privided and press enter. If you dont know the answer press Skip.
  </p>
  <!-- advanceTest(testName, formid, questid, answered = bool if the user skipped the question.) -->
  <div id="div_0" class="division">  
    <div>    
      <form name="div_0" id="div_0_form" onsubmit="event.preventDefault(); advanceTest('testdiv', 'div_0_form', 'div_0_ans', true);">
        <input type="number" id='div_0_ans' min="0" max="256" step="1" name="div_0_0" ><br>
        <label for="div_0_ans">
        <span style="border-right: 1.5px black solid; border-radius: 0px 0px 10px 0px">
    		6 
		</span>
		<span style="border-top: 1.5px black solid; ">
    		&nbsp;36 
		</span></label><br>
        <input type="hidden" id="answer" name="answer" value="6">
        <input type="hidden" id="x" name="x_val_ind" value="6">
        <input type="hidden" id="y" name="y_val_ind" value="6">
      </form>
    </div>
      <button class="button3 button12" onclick="advanceTest('testdiv', 'div_0_form', 'div_0_ans', false)">Skip</button>
      <button class="button3 button12" onclick="advanceTest('testdiv', 'div_0_form', 'div_0_ans', true)">Enter</button>
  </div>

  <p class='results' id="raw_score"></p>

  <p class='results' id="percent_score"></p>

  
  <div id="timer" class="countdownTimer">Time left = <span id="timer"></span></div>

</div>
<script>
var in_test = false
var timer_active = 0
var question_order = []
var number_correct = 0
var value = 0

function hideTab(element){
  document.getElementById(element).style.display = "none"
}
function testOpenPage(pageName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";  
  }
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    if (tablinks[i].id != "HomeTab") {
      tablinks[i].style.display = "none";
    }
  }
  testContent = document.getElementsByClassName("testContent");
  for (i=0;i < testContent.length; i++) {
    testContent[i].style.display = "none";
  }

  document.getElementById(pageName).style.display = "block";
}
//this will set the time period in minutes to the 
function submit_time(testName, formid, inputid, hasTime) {
  //This function will start the timer with the specific time submited, no timer if neccesary and start the test function. 
  var time
  if (hasTime == true) {
    time = document.getElementById(formid).elements[inputid].value;
    document.getElementById('timer').style.display = "block";
    document.getElementById('timer').innerHTML =  time + ":" + 05;
    startTimer(testName);
  }
  else {
    document.getElementById('timer').style.display = "none";
  }
  in_test = true;
  testOpenPage(testName);
  beginTest(testName);
  resetForms();
}

function resetForms() {
  var allForms = document.forms;
  var i
  for (i = 0; i < allForms.length; i ++) {
    allForms[i].reset();
  }
}

function beginTest(testName) {
  //to bigin the test we need to initialize our answers, shuffle the questions, and show the first question. 
  document.getElementById('raw_score').innerHTML = "";
  document.getElementById('percent_score').innerHTML = "";
  number_correct = 0;
  var i, elementType, questions
  elementType = getNumTestAnswers(testName);
  questions = document.getElementsByClassName(elementType);
  question_order = new Array(questions.length);
  for (i= 0; i < questions.length; i++) {
    question_order[i] = questions[i];
    question_order[i].style.display = 'none';
  }
  shuffle(question_order);
  question_order[0].style.display = 'block';


}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function advanceTest(testName, formid, questid, answered) {
  //If the bool is false then the skip was clicked, so this checks if the answer is corect 
  var answer, corect, temp
  temp = question_order[0];
  if (answered == true) {
    answer = document.getElementById(formid).elements[questid].value;
    corect = document.getElementById(formid).elements['answer'].value;
    if (answer == corect) {
        number_correct += 1;
    }
    question_order.shift();
  }
  else {
    temp = question_order.shift();
    question_order.push(temp);
  }
  temp.style.display = 'none';
  if (question_order.length == 0) {
    end_test(testName, false);
    return ;
  }
  question_order[0].style.display = 'block';
}

function end_test(testName, outOfTime) {
  if (outOfTime == true) {
    //So you ran out of time...
    question_order[0].style.display = 'none';
  }
  else {
    alert('Great Job! You finished the Test! Lets See how you did!');
  }

  var element_type = getNumTestAnswers(testName);
  var num_questions = document.getElementsByClassName(element_type);
  num_questions = num_questions.length;
  clearTimeout(timer_active);
  question_order = [];
  in_test = false;
  var percent
  if (number_correct != 0) {
    percent = Math.floor((number_correct/num_questions)*100);
  } else {
    percent = 0;
  }
  var msg1 = "Great Job you got a total of " + number_correct.toString() + " questions correct!";
  var msg2 = "That Comes out to a percent of " + percent.toString() + "&#37;";
  document.getElementById('raw_score').innerHTML = msg1;
  document.getElementById('percent_score').innerHTML = msg2;
  document.getElementById('timer').style.display = "none";

}
 
function getNumTestAnswers(testName) {
  if (testName == "testmult") {
    return 'multiplication';
  }
  if (testName == "testdiv") {
  	return 'division';
  }
}

function startTimer(testName) {
  var presentTime = document.getElementById('timer').innerHTML;
  var timerArray = presentTime.split(/[:]+/);
  var m = timerArray[0];
  var s= checkSecond((timerArray[1] - 1));
  if(s==59){m=m-1}
    //will add a function that ends the test that is called when the timer runs out
  if(m<0){
    alert('Time Is Up, Lets See How You Did!');
    end_test(testName, true);
    return false;
  }

  document.getElementById('timer').innerHTML = m + ":" + s;
  console.log(m)
  timer_active = setTimeout(startTimer, 1000);
}

function checkSecond(sec) {
  if (sec < 10 && sec >= 0) {sec = "0" + sec}; // add zero in front of numbers < 10
  if (sec < 0) {sec = "59"};
  return sec;
}

function returnInterupt() {
  var result = true
  if (in_test == true) {
    result = confirm("Are you sure you want to exit the test, your progress will be lost?");
    if (result==true) {
      clearTimeout(timer_active);
      number_correct = 0;
      location.href = "index.html";
    }
    else {
      return false;
    }
  }
  else {
    location.href = "index.html";
  }

}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();
</script>



</body>

</html>
